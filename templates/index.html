<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KU Timetable Builder</title>
    <style>
        :root { --primary-color: #8b0029; } /* Í≥†Î†§ÎåÄ ÌÅ¨Î¶ºÏä® ÏÉâÏÉÅ */
        body { font-family: 'Pretendard', sans-serif; background-color: #f8f9fa; margin: 0; padding: 15px; color: #333; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { margin-top: 0; color: var(--primary-color); font-size: 1.2rem; text-align: center; }
        
        input, button { 
            width: 100%; padding: 12px; margin: 8px 0; 
            border: 1px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box;
        }
        button { 
            background-color: var(--primary-color); color: white; border: none; 
            font-weight: bold; cursor: pointer; margin-top: 15px;
        }
        
        .result-info { text-align: center; margin-bottom: 15px; font-weight: bold; }
        
        /* ÏãúÍ∞ÑÌëú Í∑∏Î¶¨Îìú Ïä§ÌÉÄÏùº */
        .timetable-container { 
            overflow-x: auto; background: white; padding: 10px; border-radius: 8px;
            border: 1px solid #eee; margin-bottom: 30px;
        }
        table { border-collapse: collapse; table-layout: fixed; width: 600px; position: relative; }
        th, td { border: 1px solid #eee; height: 50px; text-align: center; position: relative; font-size: 10px; }
        th { background-color: #f8f9fa; height: 35px; color: #666; }
        .time-label { width: 50px; background-color: #f8f9fa; color: #999; }
        
        /* Í≥ºÎ™© Î∏îÎ°ù */
        .subject-block {
            position: absolute; left: 0; right: 0; top: 0;
            border-radius: 4px; padding: 4px 2px; color: white;
            display: flex; flex-direction: column; justify-content: center;
            box-sizing: border-box; z-index: 5; line-height: 1.1;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .subject-name { font-weight: bold; font-size: 10px; margin-bottom: 2px; }
    </style>
</head>
<body>

<div class="card">
    <h2>üêØ KU ÏãúÍ∞ÑÌëú ÎπåÎçî (PWA)</h2>
    <input type="text" id="subjects" placeholder="ÌõÑÎ≥¥ Í≥ºÎ™© (Ïòà: MATH161, COSE221-01)">
    <input type="number" id="min_courses" placeholder="ÏµúÏÜå Í≥ºÎ™© Ïàò (Ïòà: 5)">
    <input type="text" id="required" placeholder="ÌïÑÏàò Ìè¨Ìï® Í≥ºÎ™© (ÏÑ†ÌÉù) ÌõÑÎ≥¥Í≥ºÎ™©Ïóê ÏûàÏñ¥Ïïº Ìï©ÎãàÎã§">
    <button onclick="getSchedule()">Ï°∞Ìï© Í≥ÑÏÇ∞ÌïòÍ∏∞</button>
</div>

<div id="status" class="result-info"></div>
<div id="resultArea"></div>

<script>
    const colors = ['#ef5350', '#66bb6a', '#42a5f5', '#fbc02d', '#ab47bc', '#26a69a', '#ffa726', '#78909c'];
    const days = ['Ïõî', 'Ìôî', 'Ïàò', 'Î™©', 'Í∏à'];

    async function getSchedule() {
        const btn = document.querySelector('button');
        btn.innerText = "Í≥ÑÏÇ∞ Ï§ë...";
        btn.disabled = true;

        try {
            const res = await fetch('/solve', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    subjects: document.getElementById('subjects').value,
                    min_courses: document.getElementById('min_courses').value,
                    required: document.getElementById('required').value
                })
            });
            const data = await res.json();
            document.getElementById('status').innerText = `Ï¥ù ${data.length}Í∞úÏùò Ï°∞Ìï© Î∞úÍ≤¨`;
            renderResults(data);
        } catch (e) {
            alert("Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
        } finally {
            btn.innerText = "Ï°∞Ìï© Í≥ÑÏÇ∞ÌïòÍ∏∞";
            btn.disabled = false;
        }
    }

    function renderResults(results) {
        const container = document.getElementById('resultArea');
        container.innerHTML = "";

        results.forEach((schedule, idx) => {
            let html = `<div class="card"><h3>ÌõÑÎ≥¥ ${idx + 1}Î≤à (${schedule.length}Í≥ºÎ™©)</h3>`;
            html += `<div class="timetable-container"><table><thead><tr><th class="time-label"></th>`;
            days.forEach(d => html += `<th>${d}</th>`);
            html += `</tr></thead><tbody>`;

            // 1~10ÍµêÏãú Ìñâ ÏÉùÏÑ±
            for (let p = 1; p <= 10; p++) {
                html += `<tr><td class="time-label">${p}</td>`;
                days.forEach(day => {
                    html += `<td id="cell-${idx}-${day}-${p}"></td>`;
                });
                html += `</tr>`;
            }
            html += `</tbody></table></div></div>`;
            container.innerHTML += html;

            // Í≥ºÎ™© Î∏îÎ°ù Î∞∞Ïπò (DOM ÏÉùÏÑ± ÌõÑ Ï≤òÎ¶¨)
            setTimeout(() => {
                schedule.forEach((s, sIdx) => {
                    const color = colors[sIdx % colors.length];
                    s.parsed_times.forEach(time => {
                        const startP = time.periods[0];
                        const rowspan = time.periods.length;
                        const cellId = `cell-${idx}-${time.day}-${startP}`;
                        const cell = document.getElementById(cellId);
                        
                        if (cell) {
                            const block = document.createElement('div');
                            block.className = 'subject-block';
                            block.style.backgroundColor = color;
                            block.style.height = `${rowspan * 51}px`; // td ÎÜíÏù¥ 50px + Î≥¥Îçî Í≥†Î†§
                            block.innerHTML = `
                                <div class="subject-name">${s.name}</div>
                                <div style="font-size:8px;">${s.prof}</div>
                            `;
                            cell.appendChild(block);
                        }
                    });
                });
            }, 0);
        });
    }
</script>
</body>
</html>